import{j as e}from"./vendor-animation-Qsj9kxsB.js";import{r as h}from"./vendor-react-DCKpLLFa.js";import{A as g}from"./AdminLayout-B44TAUY9.js";import{u as A}from"./use-alert-modal-BAro2Nu2.js";import{u as P}from"./Header-DWqEjzJy.js";import{Y as E,Z as $,x as T,w as G}from"./index-Gdjm1SHZ.js";import{L as M,a4 as f,v as b,N as c,Q as j}from"./vendor-icons-90zywYms.js";import"./vendor-redux-CQqb5_oh.js";import"./vendor-supabase-DpMu9OXC.js";const Z=()=>{const{data:N,isLoading:v,error:w}=E(),[k]=$(),[y]=T(),[C]=G(),{showAlert:a}=A(),{showConfirm:R}=P(),[n,i]=h.useState(null),[d,r]=h.useState(""),o=N?.items||[],l=async(t,s)=>{R({title:"방문록 삭제",message:`"${s}"님의 방문록을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.`,type:"danger",confirmText:"삭제",cancelText:"취소",onConfirm:async()=>{try{await k(t).unwrap(),a({title:"삭제 완료",message:"방문록이 삭제되었습니다.",type:"success"})}catch{a({title:"삭제 실패",message:"방문록 삭제에 실패했습니다.",type:"error"})}}})},m=async(t,s,p)=>{try{await y({id:t,isPinned:!s}).unwrap(),a({title:s?"고정 해제":"고정 완료",message:s?`"${p}"님의 방문록 고정이 해제되었습니다.`:`"${p}"님의 방문록이 상단에 고정되었습니다.`,type:"success"})}catch{a({title:"고정 설정 실패",message:"고정 상태 변경에 실패했습니다.",type:"error"})}},x=async(t,s)=>{if(!d.trim()){a({title:"입력 오류",message:"답글 내용을 입력해주세요.",type:"warning"});return}try{await C({id:t,adminReply:d.trim()}).unwrap(),a({title:"답글 등록 완료",message:`"${s}"님의 방문록에 답글이 등록되었습니다.`,type:"success"}),i(null),r("")}catch{a({title:"답글 등록 실패",message:"답글 등록에 실패했습니다.",type:"error"})}},u=t=>new Date(t).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"});return v?e.jsx(g,{children:e.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-accent"})})}):e.jsx(g,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Guestbook"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"방문록을 관리하고 답글을 작성합니다"})]}),w&&e.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/20",children:e.jsx("p",{className:"text-sm text-destructive",children:"방문록을 불러올 수 없습니다. 다시 시도해주세요."})}),e.jsx("div",{className:"hidden md:block overflow-hidden rounded-lg border border-border bg-card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"작성자"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"내용"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"관리자 답글"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"고정"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"작성일"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"관리"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.authorAvatarUrl?e.jsx("img",{src:t.authorAvatarUrl,alt:t.authorName,className:"w-10 h-10 rounded-full border-2 border-border"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent flex items-center justify-center text-white font-semibold text-sm",children:t.authorName[0]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm truncate",children:t.authorName}),t.authorEmail&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:t.authorEmail})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-foreground line-clamp-3 whitespace-pre-wrap max-w-md",children:t.content})}),e.jsx("td",{className:"px-6 py-4",children:n===t.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:d,onChange:s=>r(s.target.value),placeholder:"답글을 입력하세요...",className:"w-full min-h-[80px] px-3 py-2 bg-background border border-border rounded-lg text-sm resize-vertical focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x(t.id,t.authorName),className:"px-3 py-1.5 bg-accent text-white rounded-md text-xs font-medium hover:bg-accent/90 transition-colors cursor-pointer",children:"등록"}),e.jsx("button",{onClick:()=>{i(null),r("")},className:"px-3 py-1.5 bg-muted text-foreground rounded-md text-xs font-medium hover:bg-muted/80 transition-colors cursor-pointer",children:"취소"})]})]}):t.adminReply?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-foreground line-clamp-2 whitespace-pre-wrap",children:t.adminReply}),e.jsxs("button",{onClick:()=>{i(t.id),r(t.adminReply||"")},className:"inline-flex items-center gap-1 px-2.5 py-1 bg-muted text-muted-foreground rounded-md text-xs hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(f,{className:"w-3 h-3"}),"수정"]})]}):e.jsxs("button",{onClick:()=>{i(t.id),r("")},className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-accent text-white rounded-md text-xs font-medium hover:bg-accent/90 transition-colors cursor-pointer",children:[e.jsx(b,{className:"w-3.5 h-3.5"}),"답글 작성"]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("button",{onClick:()=>m(t.id,t.isPinned,t.authorName),className:`inline-flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium transition-colors cursor-pointer ${t.isPinned?"bg-accent text-white hover:bg-accent/90":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:[e.jsx(c,{className:`w-3 h-3 ${t.isPinned?"fill-current":""}`}),t.isPinned?"고정됨":"고정"]})}),e.jsx("td",{className:"px-6 py-4 text-center text-sm text-muted-foreground whitespace-nowrap",children:u(t.createdAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{onClick:()=>l(t.id,t.authorName),className:"p-2 rounded-md hover:bg-destructive/10 transition-colors text-destructive cursor-pointer",title:"삭제",children:e.jsx(j,{className:"w-4 h-4"})})})})]},t.id))})]})})}),e.jsx("div",{className:"md:hidden space-y-4",children:o.map(t=>e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.authorAvatarUrl?e.jsx("img",{src:t.authorAvatarUrl,alt:t.authorName,className:"w-10 h-10 rounded-full border-2 border-border flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent flex items-center justify-center text-white font-semibold text-sm flex-shrink-0",children:t.authorName[0]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-semibold text-sm truncate",children:t.authorName}),t.authorEmail&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:t.authorEmail})]})]}),t.isPinned&&e.jsx(c,{className:"w-4 h-4 text-accent fill-current flex-shrink-0"})]}),e.jsx("div",{className:"text-sm text-foreground whitespace-pre-wrap",children:t.content}),n===t.id?e.jsxs("div",{className:"space-y-2 pt-3 border-t border-border",children:[e.jsx("textarea",{value:d,onChange:s=>r(s.target.value),placeholder:"답글을 입력하세요...",className:"w-full min-h-[80px] px-3 py-2 bg-background border border-border rounded-lg text-sm resize-vertical focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x(t.id,t.authorName),className:"flex-1 px-3 py-2 bg-accent text-white rounded-md text-sm font-medium hover:bg-accent/90 transition-colors cursor-pointer",children:"등록"}),e.jsx("button",{onClick:()=>{i(null),r("")},className:"flex-1 px-3 py-2 bg-muted text-foreground rounded-md text-sm font-medium hover:bg-muted/80 transition-colors cursor-pointer",children:"취소"})]})]}):t.adminReply?e.jsxs("div",{className:"space-y-2 pt-3 border-t border-border",children:[e.jsx("div",{className:"text-xs text-muted-foreground font-semibold",children:"관리자 답글"}),e.jsx("div",{className:"text-sm text-foreground whitespace-pre-wrap",children:t.adminReply}),e.jsxs("button",{onClick:()=>{i(t.id),r(t.adminReply||"")},className:"inline-flex items-center gap-1 px-2.5 py-1 bg-muted text-muted-foreground rounded-md text-xs hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(f,{className:"w-3 h-3"}),"수정"]})]}):null,e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-border",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:u(t.createdAt)}),e.jsxs("div",{className:"flex items-center gap-2",children:[!t.adminReply&&e.jsxs("button",{onClick:()=>{i(t.id),r("")},className:"inline-flex items-center gap-1 px-3 py-1.5 bg-accent text-white rounded-md text-xs font-medium hover:bg-accent/90 transition-colors cursor-pointer",children:[e.jsx(b,{className:"w-3 h-3"}),"답글"]}),e.jsxs("button",{onClick:()=>m(t.id,t.isPinned,t.authorName),className:`inline-flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-medium transition-colors cursor-pointer ${t.isPinned?"bg-accent text-white hover:bg-accent/90":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:[e.jsx(c,{className:`w-3 h-3 ${t.isPinned?"fill-current":""}`}),(t.isPinned,"고정")]}),e.jsx("button",{onClick:()=>l(t.id,t.authorName),className:"px-3 py-1.5 rounded-md hover:bg-destructive/10 transition-colors text-destructive cursor-pointer",title:"삭제",children:e.jsx(j,{className:"w-4 h-4"})})]})]})]},t.id))}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["전체 ",e.jsx("span",{className:"font-semibold text-foreground",children:o.length}),"개의 방문록"]})]})})};export{Z as AdminGuestbookPage,Z as default};
