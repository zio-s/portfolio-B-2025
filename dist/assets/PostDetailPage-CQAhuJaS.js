import{j as e,m as o,A as U}from"./vendor-animation-Qsj9kxsB.js";import{r as N,f as q,h as G,L as A}from"./vendor-react-DCKpLLFa.js";import{k as E,l as T,G as H,H as K,I as z,J as Q,C as V,D as W,K as X,E as Z}from"./index-Gdjm1SHZ.js";import{M as P,S as Y}from"./SEO-DzEyBoZz.js";import{S,C as L}from"./section-B_BI7cPF.js";import{B as M}from"./button-DgHbXKZY.js";import{B as ee}from"./badge-CI1yv82F.js";import{U as te,t as se,X as re,L as R,W as ae,M as $,R as ne,Q as I,C as _,K as D,w as oe,Z as ie,H as le,E as ce,S as de}from"./vendor-icons-90zywYms.js";import{u as B}from"./use-alert-modal-BAro2Nu2.js";import{u as F}from"./Header-DWqEjzJy.js";import{M as me,r as xe,a as ue}from"./vendor-markdown-DrJZ0HOv.js";import"./vendor-redux-CQqb5_oh.js";import"./vendor-supabase-DpMu9OXC.js";const J=({postId:s,parentId:c=null,onSuccess:i,onCancel:p,placeholder:b="댓글을 작성해주세요..."})=>{const l=E(T),a=!!l,[t,f]=N.useState(""),[u,v]=N.useState(""),[w,g]=N.useState(""),[C,d]=N.useState(""),[m,{isLoading:n}]=H(),k=()=>t.trim()?!a&&!u.trim()?(d("이름을 입력해주세요."),!1):!0:(d("댓글 내용을 입력해주세요."),!1),h=async x=>{if(x.preventDefault(),d(""),!!k())try{const r=await m({post_id:s,content:t.trim(),author_name:a?l.name:u.trim(),author_email:a?l.email:w.trim()||void 0,parent_id:c||null}).unwrap();if(r&&typeof r=="object"&&"id"in r){const y=JSON.parse(localStorage.getItem("myComments")||"[]");y.push(r.id),localStorage.setItem("myComments",JSON.stringify(y))}f(""),v(""),g(""),d(""),i?.()}catch(r){const y=r&&typeof r=="object"&&"message"in r&&typeof r.message=="string"?r.message:"댓글 작성에 실패했습니다.";d(y)}},j=()=>{f(""),d(""),p?.()};return e.jsxs(o.form,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},onSubmit:h,className:`flex flex-col gap-3 ${c?"p-3 bg-accent/5 rounded-lg border border-accent/10":"p-4 bg-card rounded-xl border border-border"}`,children:[a&&!c&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-accent to-accent/60 flex items-center justify-center text-white text-xs font-semibold",children:l.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:l.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"본 댓글 작성"})]}),!a&&e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:u,onChange:x=>v(x.target.value),placeholder:"이름 *",disabled:n,className:"w-full pl-10 pr-4 py-2.5 border border-border rounded-lg text-sm bg-background text-foreground placeholder:text-muted-foreground focus:ring-2 focus:ring-accent/20 focus:border-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed"})]})}),e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"email",value:w,onChange:x=>g(x.target.value),placeholder:"이메일 (선택)",disabled:n,className:"w-full pl-10 pr-4 py-2.5 border border-border rounded-lg text-sm bg-background text-foreground placeholder:text-muted-foreground focus:ring-2 focus:ring-accent/20 focus:border-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed"})]})})]}),e.jsx("textarea",{value:t,onChange:x=>f(x.target.value),placeholder:b,disabled:n,rows:c?3:4,className:"w-full px-4 py-3 border border-border rounded-lg text-sm bg-background text-foreground placeholder:text-muted-foreground focus:ring-2 focus:ring-accent/20 focus:border-accent transition-colors resize-none disabled:opacity-50 disabled:cursor-not-allowed"}),C&&e.jsx(o.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"flex items-center gap-2 text-xs text-destructive bg-destructive/10 px-3 py-2 rounded-lg",children:e.jsx("span",{children:C})}),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsxs("div",{className:"flex gap-2",children:[p&&e.jsxs("button",{type:"button",onClick:j,disabled:n,className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground border border-border rounded-lg hover:bg-accent/5 transition-all disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"취소"]}),e.jsx("button",{type:"submit",disabled:n||!a&&!u.trim()||!t.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-accent hover:bg-accent/90 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2 shadow-sm hover:shadow-md",children:n?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 animate-spin"}),"작성 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),c?"답글 작성":"댓글 작성"]})})]})})]})},pe=({postId:s,maxDepth:c=3})=>{const{data:i,isLoading:p,error:b,refetch:l}=K(s);return p?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>e.jsxs("div",{className:"flex gap-3 p-4 border-t border-border",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/10 animate-pulse shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-accent/10 rounded w-1/4 animate-pulse"}),e.jsx("div",{className:"h-3 bg-accent/10 rounded w-3/4 animate-pulse"}),e.jsx("div",{className:"h-3 bg-accent/10 rounded w-1/2 animate-pulse"})]})]},a))}):b?e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"p-8 text-center bg-destructive/10 border border-destructive/30 rounded-xl",children:[e.jsx("p",{className:"text-destructive font-medium mb-3",children:"댓글을 불러오는데 실패했습니다."}),e.jsx("button",{onClick:()=>l(),className:"px-4 py-2 bg-destructive text-white rounded-lg text-sm hover:bg-destructive/90 transition-colors",children:"다시 시도"})]}):!i||i.length===0?e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"py-12 px-6 text-center bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-4 text-accent/50"}),e.jsx("p",{className:"text-base text-muted-foreground mb-2",children:"아직 댓글이 없습니다"}),e.jsx("p",{className:"text-sm text-muted-foreground/70",children:"첫 번째 댓글을 작성해보세요!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx($,{className:"w-5 h-5 text-accent"}),e.jsxs("span",{className:"text-lg font-semibold text-foreground",children:["댓글 ",e.jsx("span",{className:"text-accent",children:i.length}),"개"]})]}),e.jsx("div",{className:"space-y-0",children:i.map((a,t)=>e.jsx(O,{comment:a,postId:s,depth:0,maxDepth:c,isLast:t===i.length-1},a.id))})]})},O=({comment:s,postId:c,depth:i,maxDepth:p,isLast:b=!1})=>{const[l,a]=N.useState(!1),[t,{isLoading:f}]=z(),{showAlert:u}=B(),{showConfirm:v}=F(),w=()=>JSON.parse(localStorage.getItem("myComments")||"[]").includes(s.id),g=()=>{a(!1)},C=()=>{v({title:"댓글 삭제",message:"댓글을 삭제하시겠습니까?",type:"danger",confirmText:"삭제",cancelText:"취소",onConfirm:async()=>{try{await t(s.id).unwrap();const n=JSON.parse(localStorage.getItem("myComments")||"[]").filter(k=>k!==s.id);localStorage.setItem("myComments",JSON.stringify(n)),u({title:"완료",message:"댓글이 삭제되었습니다",type:"success"})}catch{u({title:"오류",message:"댓글 삭제에 실패했습니다",type:"error"})}}})},d=m=>{const n=new Date(m),h=new Date().getTime()-n.getTime(),j=Math.floor(h/6e4),x=Math.floor(h/36e5),r=Math.floor(h/864e5);return j<1?"방금 전":j<60?`${j}분 전`:x<24?`${x}시간 전`:r<7?`${r}일 전`:n.toLocaleDateString("ko-KR",{year:"numeric",month:"short",day:"numeric"})};return e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:`${b?"":"border-b border-border"}`,children:[e.jsxs("div",{className:`flex gap-3 p-4 ${i>0?"ml-8 pl-6 border-l-2 border-accent/20":""}`,children:[e.jsx("div",{className:"shrink-0",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-accent/20 to-accent/40 flex items-center justify-center text-accent font-semibold text-sm border-2 border-accent/10",children:s.author_name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-foreground",children:s.author_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:d(s.created_at)})]}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed whitespace-pre-wrap mb-3",children:s.content}),e.jsxs("div",{className:"flex items-center gap-4",children:[i<p&&e.jsxs("button",{onClick:()=>a(!l),className:"inline-flex items-center gap-1.5 text-xs text-accent hover:text-accent/80 font-medium transition-colors group",children:[e.jsx(ne,{className:"w-3.5 h-3.5 group-hover:translate-x-0.5 transition-transform"}),l?"취소":"답글"]}),w()&&e.jsxs("button",{onClick:C,disabled:f,className:"inline-flex items-center gap-1.5 text-xs text-destructive/70 hover:text-destructive font-medium transition-colors group disabled:opacity-50",children:[e.jsx(I,{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform"}),"삭제"]})]}),e.jsx(U,{children:l&&e.jsx(o.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"mt-3",children:e.jsx(J,{postId:c,parentId:s.id,onSuccess:g,onCancel:()=>a(!1),placeholder:`${s.author_name}님에게 답글 작성...`})})})]})]}),s.replies&&s.replies.length>0&&e.jsx("div",{children:s.replies.map((m,n)=>e.jsx(O,{comment:m,postId:c,depth:i+1,maxDepth:p,isLast:n===s.replies.length-1&&b},m.id))})]})},Me=()=>{const{id:s}=q(),c=G(),{showAlert:i}=B(),{showConfirm:p}=F(),l=!!E(T),a="/blog",{data:t,isLoading:f,error:u}=Q(s||"",{skip:!s}),[v]=V(),[w,{isLoading:g}]=W(),[C]=X(),[d,m]=N.useState(!1);N.useEffect(()=>{s&&C(s)},[s]);const n=async()=>{!s||!t||p({title:"삭제 확인",message:`"${t.title}" 게시글을 정말 삭제하시겠습니까?`,type:"danger",confirmText:"삭제",cancelText:"취소",onConfirm:async()=>{try{await v(s).unwrap(),i({title:"완료",message:"게시글이 삭제되었습니다",type:"success",onConfirm:()=>{c(a)}})}catch{i({title:"오류",message:"게시글 삭제에 실패했습니다",type:"error"})}}})},k=async()=>{if(!(!s||g||d)){m(!0);try{await w(s).unwrap()}catch{console.error("좋아요 처리 실패")}finally{setTimeout(()=>{m(!1)},500)}}},h=r=>new Date(r).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=r=>{switch(r){case"published":return"bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/20";case"draft":return"bg-gray-500/10 text-gray-600 dark:text-gray-400 border-gray-500/20";case"archived":return"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/20";default:return"bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/20"}},x=r=>{switch(r){case"published":return"발행됨";case"draft":return"임시저장";case"archived":return"보관됨";default:return r}};return f?e.jsx(P,{children:e.jsx(S,{className:"py-20",children:e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(R,{className:"w-10 h-10 animate-spin text-accent mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"게시글을 불러오는 중..."})]})})})}):u?e.jsx(P,{children:e.jsx(S,{className:"py-20",children:e.jsx(L,{children:e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"p-6 rounded-xl bg-destructive/10 border border-destructive/30 mb-6",children:[e.jsx(_,{className:"w-12 h-12 text-destructive mx-auto mb-3"}),e.jsx("p",{className:"font-medium text-destructive mb-1 text-center",children:"오류가 발생했습니다"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"data"in u?u.data?.message:"게시글을 불러올 수 없습니다"})]}),e.jsx(A,{to:a,children:e.jsxs(M,{variant:"outline",className:"w-full",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"목록으로 돌아가기"]})})]})})})}):t?e.jsxs(P,{children:[e.jsx(Y,{title:`${t.title} | Blog`,description:t.excerpt}),e.jsx(S,{className:"pt-8 pb-4",children:e.jsx(L,{children:e.jsx(A,{to:a,children:e.jsxs(M,{variant:"ghost",className:"group -ml-2",children:[e.jsx(D,{className:"w-4 h-4 mr-2 group-hover:-translate-x-1 transition-transform"}),"목록으로 돌아가기"]})})})}),e.jsx(S,{className:"py-8",children:e.jsx(L,{children:e.jsxs(o.article,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-4xl mx-auto",children:[e.jsxs("header",{className:"mb-12",children:[e.jsx("div",{className:"flex flex-col gap-4 mb-8",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold leading-tight flex-1",children:t.title}),l&&e.jsx(ee,{variant:"outline",className:`${j(t.status)} px-3 py-1.5 text-xs font-semibold border shrink-0`,children:x(t.status)})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm text-muted-foreground pb-8 border-b border-border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),t.status==="published"&&t.publishedAt?`발행일: ${h(t.publishedAt)}`:`작성일: ${h(t.createdAt)}`]}),t.updatedAt!==t.createdAt&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"수정일: ",h(t.updatedAt)]})]}),t.excerpt&&e.jsx(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"mt-8 p-6 bg-accent/5 dark:bg-accent/10 border-l-4 border-accent rounded-r-lg",children:e.jsx("p",{className:"text-lg text-muted-foreground italic leading-relaxed",children:t.excerpt})})]}),e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},className:`prose prose-lg dark:prose-invert max-w-none mb-12
                prose-headings:font-bold prose-headings:tracking-tight
                prose-h1:text-4xl prose-h1:mb-6 prose-h1:mt-12
                prose-h2:text-3xl prose-h2:mb-4 prose-h2:mt-10
                prose-h3:text-2xl prose-h3:mb-3 prose-h3:mt-8
                prose-p:leading-relaxed prose-p:mb-4
                prose-a:text-accent prose-a:no-underline hover:prose-a:underline
                prose-code:text-accent prose-code:bg-accent/10 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:before:content-[''] prose-code:after:content-['']
                prose-pre:bg-card prose-pre:border prose-pre:border-border prose-pre:shadow-lg
                prose-blockquote:border-l-accent prose-blockquote:bg-accent/5 prose-blockquote:py-1
                prose-ul:my-4 prose-ol:my-4
                prose-li:my-2
                prose-img:rounded-xl prose-img:shadow-lg
                prose-hr:border-border prose-hr:my-12
                prose-table:border-collapse prose-table:border prose-table:border-border
                prose-th:bg-accent/10 prose-th:border prose-th:border-border prose-th:p-3
                prose-td:border prose-td:border-border prose-td:p-3`,children:e.jsx(me,{remarkPlugins:[ue],rehypePlugins:[xe],children:t.content})}),t.tags.length>0&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"pt-8 border-t border-border mb-8",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-4",children:"태그"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((r,y)=>e.jsxs("span",{className:"px-4 py-2 bg-accent/10 text-accent rounded-full text-sm font-medium hover:bg-accent/20 transition-colors",children:["#",r]},y))})]}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"pt-8 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(M,{variant:"outline",size:"lg",onClick:k,disabled:g||d,className:`gap-2 transition-all ${t.is_liked?"text-red-500 border-red-500/50 hover:bg-red-50 dark:hover:bg-red-950":"hover:text-red-500 hover:border-red-500/50"} ${g||d?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(le,{className:`w-5 h-5 transition-all ${t.is_liked?"fill-current":""}`}),e.jsx("span",{className:"font-semibold",children:t.likes_count||0})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx($,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.comments_count||0,"개의 댓글"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-sm font-medium",children:[t.views_count||0,"회 조회"]})]})]})}),l&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},className:"flex gap-3 pt-8 border-t border-border",children:[e.jsx(A,{to:Z.blogEdit(t.id),className:"flex-1",children:e.jsxs(M,{variant:"outline",className:"w-full group",children:[e.jsx(de,{className:"w-4 h-4 mr-2 group-hover:rotate-12 transition-transform"}),"수정"]})}),e.jsxs(M,{variant:"outline",onClick:n,className:"flex-1 text-destructive hover:text-destructive hover:bg-destructive/10 group",children:[e.jsx(I,{className:"w-4 h-4 mr-2 group-hover:scale-110 transition-transform"}),"삭제"]})]})]})})}),e.jsx(S,{className:"py-12 bg-accent/5 dark:bg-accent/10",children:e.jsx(L,{children:e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.7},className:"max-w-4xl mx-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-8 flex items-center gap-2",children:[e.jsx($,{className:"w-6 h-6 text-accent"}),"댓글"]}),e.jsx("div",{className:"mb-8",children:e.jsx(J,{postId:s,onSuccess:()=>{},placeholder:"댓글을 작성해주세요..."})}),e.jsx(pe,{postId:s})]})})})]}):e.jsx(P,{children:e.jsx(S,{className:"py-20",children:e.jsx(L,{children:e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center py-20 max-w-md mx-auto",children:[e.jsx("div",{className:"w-24 h-24 bg-accent/10 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(_,{className:"w-12 h-12 text-accent"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"게시글을 찾을 수 없습니다"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"삭제되었거나 존재하지 않는 게시글입니다"}),e.jsx(A,{to:a,children:e.jsxs(M,{size:"lg",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"목록으로 돌아가기"]})})]})})})})};export{Me as default};
