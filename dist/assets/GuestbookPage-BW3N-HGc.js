import{j as e}from"./vendor-animation-DtZQNC6I.js";import{r as l}from"./vendor-react-DCKpLLFa.js";import{M as E,S}from"./SEO-C6FEOD3y.js";import{v as A,s as P,w as I,x as k,a as L,y as D,z as O}from"./index-EmnU2dnG.js";import{u as M}from"./use-alert-modal-B73JBodO.js";import{f as T,a as C,h as v}from"./profanityFilter-ZoX90Y-P.js";import{L as y,O as w,Q as G,M as F,w as R}from"./vendor-icons-coWQDWRu.js";import{B as V}from"./vendor-redux-CQqb5_oh.js";import"./Header-Dr8E-v62.js";import"./vendor-supabase-DpMu9OXC.js";const $=()=>{const[t,{isLoading:s}]=A(),{showAlert:o}=M(),[r,m]=l.useState({authorName:"",authorEmail:"",content:""}),f=p=>{const{name:u,value:g}=p.target;m(j=>({...j,[u]:g}))},d=()=>r.authorName.trim()?r.authorName.trim().length<2?(o({title:"ì…ë ¥ ì˜¤ë¥˜",message:"ì´ë¦„ì€ ìµœì†Œ 2ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.",type:"warning"}),!1):r.content.trim()?r.content.trim().length<2?(o({title:"ì…ë ¥ ì˜¤ë¥˜",message:"ë©”ì‹œì§€ëŠ” ìµœì†Œ 2ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.",type:"warning"}),!1):!0:(o({title:"ì…ë ¥ ì˜¤ë¥˜",message:"ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",type:"warning"}),!1):(o({title:"ì…ë ¥ ì˜¤ë¥˜",message:"ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",type:"warning"}),!1),a=async p=>{if(p.preventDefault(),!d())return;const u=T(r.authorName.trim()),g=C(r.content.trim()),j=v(r.authorName),N=v(r.content);(j||N)&&o({title:"ë‚´ìš©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤",message:"ë¶€ì ì ˆí•œ í‘œí˜„ì´ ì˜ˆìœ ë§ë¡œ ìë™ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.",type:"info"});try{await t({authorName:u,authorEmail:r.authorEmail?.trim()||void 0,content:g}).unwrap(),m({authorName:"",authorEmail:"",content:""})}catch(c){let i="ë°©ë¬¸ë¡ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";c&&typeof c=="object"&&("data"in c&&typeof c.data=="object"&&c.data?.message?i=c.data.message:"message"in c&&typeof c.message=="string"&&(i=c.message)),o({title:"ë°©ë¬¸ë¡ ë“±ë¡ ì‹¤íŒ¨",message:i,type:"error"})}};return e.jsxs("div",{className:"p-6 rounded-lg bg-card/50 backdrop-blur-sm border border-border/50",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"ë°©ë¬¸ë¡ ì‘ì„±"}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{name:"authorName",type:"text",placeholder:"ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìµœì†Œ 2ì)",value:r.authorName,onChange:f,className:"w-full p-3 pr-12 text-sm rounded-lg bg-background/50 border border-border/50 focus:border-accent focus:bg-background focus:outline-none transition-all",maxLength:50,disabled:s})}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{name:"content",placeholder:"ë”°ëœ»í•œ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.",value:r.content,onChange:f,className:"w-full p-3 text-sm rounded-lg bg-background/50 border border-border/50 focus:border-accent focus:bg-background focus:outline-none resize-none transition-all",rows:4,maxLength:1e3,disabled:s})}),e.jsx("button",{type:"submit",disabled:s,className:"w-full py-3 cursor-pointer px-4 rounded-lg bg-gradient-to-r from-accent to-accent/80 hover:from-accent/90 hover:to-accent/70 text-white font-medium text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-accent/20",children:s?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 animate-spin"}),"ë“±ë¡ ì¤‘..."]}):"ë°©ë¬¸ë¡ ë“±ë¡í•˜ê¸°"})]})]})},H=({guestbook:t})=>{const s=V(P),[o,{isLoading:r}]=I(),[m,{isLoading:f}]=k(),{showAlert:d}=M(),[a,p]=l.useState(!1),[u,g]=l.useState(""),j=n=>{const b=new Date(n),x=Math.floor((new Date().getTime()-b.getTime())/1e3);return x<60?"ë°©ê¸ˆ ì „":x<3600?`${Math.floor(x/60)}ë¶„ ì „`:x<86400?`${Math.floor(x/3600)}ì‹œê°„ ì „`:x<2592e3?`${Math.floor(x/86400)}ì¼ ì „`:x<7776e3?`${Math.floor(x/2592e3)}ë‹¬ ì „`:b.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})},N=n=>{const b=["ğŸ˜Š","ğŸ‰","ğŸ’¡","ğŸš€","âœ¨","ğŸŒŸ","ğŸ’»","ğŸ¨","ğŸ“š","ğŸ¯","ğŸ”¥","ğŸ’ª","ğŸŒˆ","â­","ğŸµ"];let h=0;for(let x=0;x<n.length;x++)h=n.charCodeAt(x)+((h<<5)-h);return b[Math.abs(h)%b.length]},c=async()=>{if(s)try{await m({id:t.id,isPinned:!t.isPinned}).unwrap(),d({title:t.isPinned?"ê³ ì • í•´ì œ":"ê³ ì • ì™„ë£Œ",message:t.isPinned?"ë°©ë¬¸ë¡ ê³ ì •ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.":"ë°©ë¬¸ë¡ì´ ìƒë‹¨ì— ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",type:"success"})}catch(n){d({title:"ê³ ì • ì‹¤íŒ¨",message:n?.data?.message||"ê³ ì • ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",type:"error"})}},i=async()=>{if(!s||!u.trim()){d({title:"ì…ë ¥ ì˜¤ë¥˜",message:"ë‹µê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",type:"warning"});return}const n=C(u.trim());v(u)&&d({title:"ë‚´ìš©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤",message:"ë¶€ì ì ˆí•œ í‘œí˜„ì´ ì˜ˆìœ ë§ë¡œ ìë™ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.",type:"info"});try{await o({id:t.id,adminReply:n}).unwrap(),g(""),p(!1),d({title:"ë‹µê¸€ ì‘ì„± ì™„ë£Œ",message:"ë‹µê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",type:"success"})}catch(h){d({title:"ë‹µê¸€ ì‘ì„± ì‹¤íŒ¨",message:h?.data?.message||"ë‹µê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",type:"error"})}};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted/50 flex items-center justify-center text-2xl border border-border",children:N(t.authorName)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:t.authorName}),e.jsx("span",{className:"text-xs text-muted-foreground",children:j(t.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.isPinned&&e.jsx(w,{className:"w-4 h-4 text-accent fill-accent"}),s&&e.jsx("button",{onClick:c,disabled:f,className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-accent transition-colors disabled:opacity-50",title:t.isPinned?"ê³ ì • í•´ì œ":"ìƒë‹¨ ê³ ì •",children:f?e.jsx(y,{className:"w-4 h-4 animate-spin"}):t.isPinned?e.jsx(G,{className:"w-4 h-4"}):e.jsx(w,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed whitespace-pre-wrap break-words mb-3",children:t.content}),s&&!t.adminReply&&e.jsxs("button",{onClick:()=>p(!a),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-accent transition-colors",children:[e.jsx(F,{className:"w-3 h-3"}),e.jsx("span",{children:a?"ì·¨ì†Œ":"ë‹µê¸€ì“°ê¸°"})]}),s&&a&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("textarea",{value:u,onChange:n=>g(n.target.value),placeholder:"ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœì†Œ 2ì)",className:"w-full p-3 text-sm rounded-lg bg-background border border-border focus:border-accent focus:outline-none resize-none",rows:3,maxLength:1e3,disabled:r}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:i,disabled:r||!u.trim(),className:"px-4 py-2 text-xs font-medium rounded-lg bg-accent text-white hover:bg-accent/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[r&&e.jsx(y,{className:"w-3 h-3 animate-spin"}),"ë‹µê¸€ ì‘ì„±"]}),e.jsx("button",{onClick:()=>{p(!1),g("")},disabled:r,className:"px-4 py-2 text-xs font-medium rounded-lg bg-muted text-foreground hover:bg-muted/80 transition-colors disabled:opacity-50",children:"ì·¨ì†Œ"})]})]}),t.adminReply&&e.jsxs("div",{className:"mt-4 flex gap-3 pl-4 border-l-2 border-accent/30",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center text-xl border border-accent/30",children:"ğŸ‘¨â€ğŸ’»"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-sm text-accent",children:"ë¦¬ì˜¤ì§±"}),e.jsx("span",{className:"px-2 py-0.5 text-[10px] font-semibold bg-accent/20 text-accent rounded",children:"ADMIN"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.adminRepliedAt&&j(t.adminRepliedAt)})]}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed whitespace-pre-wrap break-words",children:t.adminReply})]})]})]})]}),e.jsx("div",{className:"mt-6 border-t border-border/50"})]})};function z(t){const s=l.useRef(null),o=l.useRef(new Set);return l.useEffect(()=>{if(typeof window>"u")return;const m={threshold:.1,rootMargin:"0px 0px -50px 0px",...t};return s.current=new IntersectionObserver(f=>{f.forEach(d=>{d.isIntersecting&&(d.target.setAttribute("data-visible","true"),s.current&&s.current.unobserve(d.target))})},m),o.current.forEach(f=>{s.current&&s.current.observe(f)}),()=>{s.current&&s.current.disconnect()}},[t]),l.useCallback(m=>{m&&(o.current.add(m),s.current&&s.current.observe(m))},[])}const Z=()=>{const[t,s]=l.useState(void 0),[o,r]=l.useState([]),m=l.useRef(null),f=l.useRef(0),d=z(),{data:a,isLoading:p,error:u,isFetching:g}=L({limit:10,cursor:t,approvedOnly:!0}),{data:j}=D(),[N]=O();l.useEffect(()=>{const i="guestbook_last_visit",n=new Date().toISOString().split("T")[0];localStorage.getItem(i)!==n&&N().unwrap().then(()=>{localStorage.setItem(i,n)}).catch(()=>{})},[N]),l.useEffect(()=>{a?.total!==void 0&&a.total!==f.current&&(f.current=a.total,s(void 0),r([]))},[a?.total]),l.useEffect(()=>{a?.items&&r(t?i=>{const n=new Set(i.map(h=>h.id)),b=a.items.filter(h=>!n.has(h.id));return[...i,...b]}:a.items)},[a?.items,t]),l.useEffect(()=>{if(o.length===0)return;const i=m.current;if(!i||!a?.hasMore)return;const n=new IntersectionObserver(b=>{b[0].isIntersecting&&!g&&a?.hasMore&&a?.nextCursor&&s(a.nextCursor)},{threshold:.1});return n.observe(i),()=>{n.unobserve(i)}},[g,a?.hasMore,a?.nextCursor,o.length]);const c=o;return e.jsxs(E,{children:[e.jsx(S,{title:"ë°©ë¬¸ë¡ | ë³€ì„¸ë¯¼ | í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì í¬íŠ¸í´ë¦¬ì˜¤",description:"ì—¬ëŸ¬ë¶„ì˜ ì†Œì¤‘í•œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”. í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ë³€ì„¸ë¯¼ì˜ í¬íŠ¸í´ë¦¬ì˜¤ ë°©ë¬¸ë¡ì…ë‹ˆë‹¤.",url:"https://semincode.com/guestbook"}),e.jsx("div",{className:"w-full px-4 sm:px-6 max-w-[1400px] mx-auto py-12",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 lg:gap-12",children:[e.jsxs("div",{className:"flex-1 order-2 lg:order-1",children:[e.jsxs("div",{className:"mb-12",children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold mb-3 leading-tight",children:["ì—¬ëŸ¬ë¶„ì˜ ì†Œì¤‘í•œ ì˜ê²¬,",e.jsx("br",{}),"ê°ì‚¬íˆ ë“£ê² ìŠµë‹ˆë‹¤"]}),e.jsx("p",{className:"text-base text-muted-foreground mb-6",children:"í•¨ê»˜ ì„±ì¥í•˜ëŠ” ê°œë°œìê°€ ë˜ê³  ì‹¶ìŠµë‹ˆë‹¤"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsxs("span",{children:["ì˜¤ëŠ˜ ë°©ë¬¸ì",e.jsxs("span",{className:"text-accent px-1 font-bold",children:[j,"ëª…"]})]}),e.jsx("span",{className:"mx-2",children:"|"}),e.jsxs("span",{children:["ì „ì²´ ëŒ“ê¸€ ",e.jsx("span",{className:"text-accent font-bold",children:a?.total||0})]})]})]}),p&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(y,{className:"w-8 h-8 animate-spin text-accent"})}),u&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-destructive",children:"ë°©ë¬¸ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."})}),!p&&!u&&c.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ì²« ë°©ë¬¸ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”"})]}),!p&&!u&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-6",children:c.map((i,n)=>e.jsx("div",{ref:d,"data-animate":"true",style:{transitionDelay:`${n%10*.05}s`},children:e.jsx(H,{guestbook:i,showAdminBadge:!0})},i.id))}),e.jsx("div",{ref:m,className:"flex justify-center py-8",style:{display:a?.hasMore?"flex":"none"},children:g&&e.jsx(y,{className:"w-6 h-6 animate-spin text-accent"})}),!a?.hasMore&&o.length>0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"ì†Œì¤‘í•œ ê¸€ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ì—´ì‹¬íˆ í•˜ê² ìŠµë‹ˆë‹¤!"})})]})]}),e.jsx("div",{className:"w-full lg:w-[580px] order-1 lg:order-2",children:e.jsx("div",{className:"lg:sticky lg:top-[5rem] lg:max-h-[calc(100vh-6rem)]",children:e.jsx($,{})})})]})})]})};export{Z as default};
